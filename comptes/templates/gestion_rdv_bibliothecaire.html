{% extends "base.html" %}
{% block content %}
<div class="container py-5">

    <!-- Rendez-vous du jour -->
    <div class="mb-5 border-start border-3 ps-3 border-primary">
        <h3 class="mb-3 fw-light border-bottom pb-2 d-flex align-items-center">
            <i class="bi bi-calendar-day me-2 text-primary"></i> Rendez-vous du jour
        </h3>

        {% if rdvs_today %}
        <div class="table-responsive">
            <table class="table table-borderless align-middle">
                <thead>
                    <tr class="text-muted small">
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Email</th>
                        <th>Téléphone</th>
                        <th>Catégorie</th>
                        <th>Titre</th>
                        <th>Auteur</th>
                        <th>Ancien code</th>
                        <th>Inventaire</th>
                        <th>Entrée</th>
                        <th>Sortie</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody class="border-top">
                    {% for rdv in rdvs_today %}
                    <tr class="hover-row">
                        <td>{{ rdv.nom }}</td>
                        <td>{{ rdv.prenom }}</td>
                        <td class="text-muted">{{ rdv.email }}</td>
                        <td>{{ rdv.telephone }}</td>
                        <td>{{ rdv.livre.categorie }}</td>
                        <td>{{ rdv.livre.titre }}</td>
                        <td>{{ rdv.livre.auteur }}</td>
                        <td>{{ rdv.ancien_code }}</td>
                        <td>{{ rdv.numero_inventaire }}</td>
                        <td colspan="3">
                            <form method="post" 
                                  action="{% url 'gestion_rdv_bibliothecaire' %}" 
                                  class="d-flex align-items-center rdv-form">
                                {% csrf_token %}
                                <input type="time" name="heure_entree" 
                                       value="{% if rdv.heure_entree %}{{ rdv.heure_entree|time:'H:i' }}{% endif %}" 
                                       class="form-control form-control-sm me-2">
                                <input type="time" name="heure_sortie" 
                                       value="{% if rdv.heure_sortie %}{{ rdv.heure_sortie|time:'H:i' }}{% endif %}" 
                                       class="form-control form-control-sm me-2">
                                <input type="hidden" name="rdv_id" value="{{ rdv.id }}">
                                <button type="submit" class="btn btn-sm btn-black save-btn">Enregistrer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="text-center text-muted py-4">Aucun rendez-vous prévu aujourd'hui.</div>
        {% endif %}
    </div>

    <!-- Rendez-vous à venir -->
    <div class="ps-2">
        <h3 class="mb-3 fw-light border-bottom pb-2 d-flex align-items-center">
            <i class="bi bi-hourglass-split me-2 text-secondary"></i> Rendez-vous à venir
        </h3>

        {% if rdvs_future %}
        <div class="table-responsive">
            <table class="table table-borderless align-middle">
                <thead>
                    <tr class="text-muted small">
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Email</th>
                        <th>Téléphone</th>
                        <th>Catégorie</th>
                        <th>Titre</th>
                        <th>Auteur</th>
                        <th>Ancien code</th>
                        <th>Inventaire</th>
                        <th>Date prévue</th>
                    </tr>
                </thead>
                <tbody class="border-top">
                    {% for rdv in rdvs_future %}
                    <tr class="hover-row">
                        <td>{{ rdv.nom }}</td>
                        <td>{{ rdv.prenom }}</td>
                        <td class="text-muted">{{ rdv.email }}</td>
                        <td>{{ rdv.telephone }}</td>
                        <td>{{ rdv.livre.categorie }}</td>
                        <td>{{ rdv.livre.titre }}</td>
                        <td>{{ rdv.livre.auteur }}</td>
                        <td>{{ rdv.ancien_code }}</td>
                        <td>{{ rdv.numero_inventaire }}</td>
                        <td>{{ rdv.date_souhaitee }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="text-center text-muted py-4">Aucun rendez-vous futur enregistré.</div>
        {% endif %}
    </div>

</div>

<style>
    h3 { font-weight: 300; letter-spacing: 0.3px; }
    .table th { font-weight: 500; }
    .hover-row:hover { background-color: #f8f9fa; transition: background 0.2s ease; }
    .form-control-sm { font-size: 0.85rem; padding: 0.25rem 0.5rem; }
    
    /* Bouton moderne noir/blanc */
    .btn-black {
        background-color: #000;
        color: #fff;
        border: none;
        transition: all 0.3s ease;
    }
    .btn-black:hover {
        background-color: #333;
        color: #fff;
    }

    /* Bouton enregistré */
    .btn-registered {
        background-color: #fff;
        color: #000;
        border: 2px solid #000;
        cursor: default;
    }
</style>

<!-- Script AJAX pour mise à jour du bouton -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll(".rdv-form").forEach(form => {
        form.addEventListener("submit", function(event) {
            event.preventDefault();
            let btn = form.querySelector(".save-btn");

            fetch(form.action, {
                method: "POST",
                body: new FormData(form),
                headers: { "X-Requested-With": "XMLHttpRequest" }
            })
            .then(response => {
                if (response.ok) {
                    btn.textContent = "Rendez-vous enregistré !";
                    btn.classList.remove("btn-black");
                    btn.classList.add("btn-registered");
                    btn.disabled = true;
                }
            });
        });
    });
});
</script>
{% endblock %}












