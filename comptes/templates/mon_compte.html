{% extends "base.html" %}
{% load static %}
{% load comptes_extras %}

{% block content %}
<div class="container my-5">
  <div class="card shadow-sm mx-auto" style="max-width: 900px;">

    <div class="card-header bg-white border-bottom d-flex align-items-center">
      {% if request.session.utilisateur_profile.photo %}
        <img src="{{ request.session.utilisateur_profile.photo }}" 
             alt="Photo de profil" class="rounded-circle" width="80" height="80" style="object-fit: cover;">
      {% else %}
        <img src="{% static 'img/default-avatar.png' %}" 
             alt="Photo de profil par défaut" class="rounded-circle" width="80" height="80" style="object-fit: cover;">
      {% endif %}
      <div class="ms-3">
        <h2 class="mb-0">{{ request.session.utilisateur_profile.prenom|default:"Utilisateur" }} {{ request.session.utilisateur_profile.nom|default:"" }}</h2>
        <small class="text-muted">{{ request.session.utilisateur_profile.email|default:"Email non disponible" }}</small>
      </div>
    </div>

    <div class="card-body px-4 py-4">
      <!-- Informations personnelles -->
      <section class="mb-4">
        <h5><i class="bi bi-person-fill me-2"></i>Informations personnelles</h5>
        <hr>
        <div class="row">
          <div class="col-md-6 mb-2">
            <strong>Prénom :</strong> {{ request.session.utilisateur_profile.prenom|default:"Non renseigné" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Nom :</strong> {{ request.session.utilisateur_profile.nom|default:"Non renseigné" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Adresse email :</strong> {{ request.session.utilisateur_profile.email|default:"Non renseigné" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Numéro de téléphone :</strong> {{ request.session.utilisateur_profile.telephone|default:"Non renseigné" }}
          </div>
          <div class="col-md-12 mb-2">
            <strong>Adresse postale :</strong> 
            {% if request.session.utilisateur_profile.adresse %}
              {{ request.session.utilisateur_profile.adresse }}
            {% else %}
              Non renseignée
            {% endif %}
          </div>
        </div>
      </section>

      <!-- Profil professionnel / Statut utilisateur -->
      <section class="mb-4">
        <h5><i class="bi bi-briefcase-fill me-2"></i>Profil professionnel / Statut utilisateur</h5>
        <hr>
        <div class="row">
          <div class="col-md-6 mb-2">
            <strong>Type d'utilisateur :</strong> {{ request.session.utilisateur_profile.type_utilisateur|default:"Lecteur" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Profession :</strong> {{ request.session.utilisateur_profile.profession|default:"Non renseigné" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Institution / entreprise :</strong> {{ request.session.utilisateur_profile.institution|default:"Non renseigné" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Secteur d'activité :</strong> {{ request.session.utilisateur_profile.secteur_activite|default:"Non renseigné" }}
          </div>
        </div>
      </section>

      <!-- Informations liées à la bibliothèque -->
      <section class="mb-4">
        <h5><i class="bi bi-journal-bookmark-fill me-2"></i>Informations liées à la bibliothèque</h5>
        <hr>
        <div class="row">
          <div class="col-md-6 mb-2">
            <strong>Date d'inscription :</strong> {{ request.session.utilisateur_profile.created_at|date:"d/m/Y"|default:"Non disponible" }}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Dernière connexion :</strong> 
            {% if request.session.utilisateur_profile.last_sign_in_at %}
              {{ request.session.utilisateur_profile.last_sign_in_at|date:"d/m/Y H:i" }}
            {% else %}
              Première connexion
            {% endif %}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Statut du compte :</strong> 
            {% if request.session.utilisateur_profile.est_actif %}
              <span class="badge bg-success">Actif</span>
            {% else %}
              <span class="badge bg-danger">Inactif</span>
            {% endif %}
          </div>
          <div class="col-md-6 mb-2">
            <strong>Rôle principal :</strong>
            {% if request.session.utilisateur_profile.type_utilisateur == "Admin" %}
              <span class="badge bg-danger">Administrateur</span>
            {% elif request.session.utilisateur_profile.type_utilisateur == "Bibliothecaire" %}
              <span class="badge bg-primary">Bibliothécaire</span>
            {% elif request.session.utilisateur_profile.type_utilisateur == "Personnel" %}
              <span class="badge bg-warning text-dark">Personnel administratif</span>
            {% else %}
              <span class="badge bg-info">Lecteur</span>
            {% endif %}
          </div>
          <div class="col-md-12 mb-2">
            <small class="text-muted">
              <i class="bi bi-info-circle me-1"></i>
              Ce rôle vous a été attribué par le super administrateur et détermine vos permissions dans la bibliothèque.
            </small>
          </div>
          
          <!-- Détail des permissions selon le rôle -->
          <div class="col-md-12 mt-3">
            <div class="alert alert-light border">
              <h6 class="mb-2"><i class="bi bi-shield-check me-2"></i>Vos permissions actuelles :</h6>
              {% if request.session.utilisateur_profile.type_utilisateur == "Admin" %}
                <ul class="mb-0 small">
                  <li>Gestion complète de tous les utilisateurs</li>
                  <li>Promotion et rétrogradation des rôles</li>
                  <li>Accès à toutes les fonctionnalités de la bibliothèque</li>
                </ul>
              {% elif request.session.utilisateur_profile.type_utilisateur == "Bibliothecaire" %}
                <ul class="mb-0 small">
                  <li>Gestion des livres et catégories</li>
                  <li>Gestion des rendez-vous</li>
                  <li>Accès aux notifications bibliothécaire</li>
                </ul>
              {% elif request.session.utilisateur_profile.type_utilisateur == "Personnel" %}
                <ul class="mb-0 small">
                  <li>Gestion administrative des rendez-vous</li>
                  <li>Accès aux notifications personnel</li>
                  <li>Support utilisateur</li>
                </ul>
              {% else %}
                <ul class="mb-0 small">
                  <li>Consultation du catalogue</li>
                  <li>Gestion de vos favoris</li>
                  <li>Prise de rendez-vous</li>
                  <li>Accès à vos notifications</li>
                </ul>
              {% endif %}
            </div>
          </div>
        </div>
      </section>

      <!-- Options de gestion du compte -->
      <section class="mb-4">
        <h5><i class="bi bi-gear-fill me-2"></i>Options de gestion du compte</h5>
        <hr>
        <div class="d-flex flex-wrap gap-3">
          <a href="#" class="btn btn-outline-primary" onclick="alert('Fonctionnalité en cours de développement')">
            <i class="bi bi-pencil-fill me-1"></i>Modifier mes informations
          </a>
          <a href="#" class="btn btn-outline-secondary" onclick="alert('Fonctionnalité en cours de développement')">
            <i class="bi bi-lock-fill me-1"></i>Changer le mot de passe
          </a>
          
          <!-- Lien d'administration pour le super admin -->
          {% if request.session.utilisateur_profile.type_utilisateur == "Admin" %}
            <a href="#" class="btn btn-outline-warning" onclick="alert('Fonctionnalité en cours de développement')">
              <i class="bi bi-people-fill me-1"></i>Administration des Utilisateurs
            </a>
          {% endif %}
          
          <a href="{% url 'deconnexion' %}" class="btn btn-outline-danger ms-auto">
            <i class="bi bi-box-arrow-right me-1"></i>Déconnexion
          </a>
        </div>
      </section>

      <!-- Autres éléments utiles -->
      <section class="mb-3 text-center">
        <a href="#" class="btn btn-link" onclick="alert('Fonctionnalité en cours de développement')">Support / Contact aide</a> |
        <a href="#" class="btn btn-link" onclick="alert('Fonctionnalité en cours de développement')">Conditions générales</a>
      </section>
    </div>
  </div>
</div>

<!-- Bootstrap Icons CDN (si pas encore inclus) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{% endblock %}

